<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UBUNTU ë§¤ì¹­ì‹œìŠ¤í…œ v8.5</title>
    <script>
        tailwind.config = {
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #d4edda; letter-spacing: -0.025em; -webkit-tap-highlight-color: transparent; } /* Changed to light green */
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); }
        .stadium-panel { background: linear-gradient(145deg, #0f172a 0%, #1e293b 100%); }
        .male-gradient { background: linear-gradient(to right, #eff6ff, #dbeafe); border-left: 4px solid #2563eb; color: #1e40af; }
        .female-gradient { background: linear-gradient(to right, #fff1f2, #ffe4e6); border-left: 4px solid #e11d48; color: #9f1239; }
        
        /* íƒ€ì„ë¼ì¸ ê°€ë¡œ ìŠ¤í¬ë¡¤ ìœ ì§€ */
        .timeline-scroll { display: flex; overflow-x: auto; gap: 1rem; padding-bottom: 20px; }
        .court-column { min-width: 300px; flex-shrink: 0; }
        
        /* [V8.5 í•µì‹¬] ìº¡ì²˜ìš© ì„ì‹œ í´ë˜ìŠ¤: ê°€ë¡œ ìŠ¤í¬ë¡¤ì„ í•´ì œí•˜ê³  ì „ì²´ë¥¼ í¼ì¹¨ */
        .capture-mode { display: block !important; overflow: visible !important; width: fit-content !important; }
        .capture-mode .court-column { margin-bottom: 2rem; width: 600px !important; } /* ìº¡ì²˜ ì‹œ ê°€ë¡œí­ ê³ ì • */

        @keyframes rank-pulse {
            0% { transform: scale(1.02); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1.02); }
        }
        .rank-1 { 
            background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); 
            border: 1px solid #fbbf24; 
            color: #92400e !important; 
            box-shadow: 0 10px 20px rgba(251, 191, 36, 0.4);
            transform: scale(1.02);
            position: relative;
            z-index: 10;
            animation: rank-pulse 2s infinite ease-in-out;
        }
        .rank-2 { 
            background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%); 
            border: 1px solid #94a3b8; 
            color: #334155 !important;
            box-shadow: 0 6px 12px rgba(148, 163, 184, 0.2);
        }
        .rank-3 { 
            background: linear-gradient(135deg, #ffedd5 0%, #fdba74 100%); 
            border: 1px solid #f97316; 
            color: #7c2d12 !important;
            box-shadow: 0 6px 12px rgba(249, 115, 22, 0.2);
        }
        .rank-1:hover, .rank-2:hover, .rank-3:hover {
            transform: translateY(-3px) scale(1.05);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: brightness(1.05);
        }
        .score-input { width: 50px; text-align: center; font-weight: 900; font-size: 1.1rem; background: #f8fafc; border-radius: 8px; border: 2px solid #e2e8f0; padding: 5px 0; }
        .match-finished { opacity: 0.5; pointer-events: none; filter: grayscale(0.8); }
        ::-webkit-scrollbar { height: 5px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }


    </style>
</head>
<body class="p-3 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-black italic text-slate-900 uppercase tracking-tighter">UBUNTU <span class="text-blue-600">ë§¤ì¹­ì‹œìŠ¤í…œ</span></h1>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.3em] mt-1">Full Export Engine v8.5 <span id="app-version" class="text-blue-500 ml-2"></span></p>
            </div>
            <div class="flex flex-wrap gap-2">
                <button onclick="exportData()" class="bg-blue-50 text-blue-600 px-3 py-2 rounded-xl text-[10px] font-black border border-blue-100">ë‚´ë³´ë‚´ê¸°</button>
                <button onclick="document.getElementById('importFile').click()" class="bg-orange-50 text-orange-600 px-3 py-2 rounded-xl text-[10px] font-black border border-orange-100">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(event)">
                <div class="h-8 w-[1px] bg-slate-200 mx-1 hidden md:block"></div>
                <button onclick="copyToClipboard()" class="bg-slate-200 text-slate-700 px-3 py-2 rounded-xl text-[10px] font-black">ì¹´í†¡ ë³µì‚¬</button>
                <button onclick="saveAsImage()" class="bg-slate-800 text-white px-4 py-2 rounded-xl text-[11px] font-black shadow-lg">ì „ì²´ ì´ë¯¸ì§€ ì €ì¥ ğŸ“¸</button>

            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-8">
            <div class="lg:col-span-4 space-y-4">
                <div class="glass-card p-5 rounded-[2rem]">
                    <h3 class="text-[10px] font-black text-slate-400 uppercase mb-3">Player Manager</h3>
                    <div class="space-y-2 mb-4">
                        <input type="text" id="p-name" placeholder="ì´ë¦„" class="w-full p-2.5 border rounded-xl text-xs font-bold outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex gap-2">
                            <select id="p-gender" class="flex-1 p-2.5 border rounded-xl text-xs font-bold"><option value="ë‚¨">ë‚¨ì„±</option><option value="ì—¬">ì—¬ì„±</option></select>
                            <input type="number" id="p-ntpr" step="0.1" value="3.0" class="flex-1 p-2.5 border rounded-xl text-xs font-bold">
                        </div>
                        <div class="flex gap-1.5">
                            <button onclick="addOrUpdatePlayer()" id="submit-btn" class="flex-grow bg-slate-900 text-white py-2.5 rounded-xl text-[10px] font-black uppercase">Add / Update</button>
                            <button onclick="resetForm()" id="cancel-btn" class="hidden px-3 bg-slate-200 py-2.5 rounded-xl text-[10px] font-black">X</button>
                        </div>
                    </div>
                    <div id="member-library" class="grid grid-cols-2 gap-2 max-h-56 overflow-y-auto pr-1"></div>
                </div>

                <div class="glass-card p-5 rounded-[2rem]">
                    <h3 class="text-[10px] font-black text-slate-400 uppercase mb-2">ì½”íŠ¸ëŒ€ê´€ìƒíƒœ</h3>
                    <select id="court-count" class="w-full p-2.5 rounded-xl border-slate-200 border bg-white font-black text-[11px] outline-none">
                        <option value="1">1ê°œ ì½”íŠ¸</option><option value="2" selected>2ê°œ ì½”íŠ¸</option><option value="3">3ê°œ ì½”íŠ¸</option><option value="4">4ê°œ ì½”íŠ¸</option><option value="5">5ê°œ ì½”íŠ¸</option>
                    </select>
                    <div id="court-config-list" class="mt-2 space-y-1.5"></div>
                </div>
            </div>

            <div class="lg:col-span-8">
                <div class="stadium-panel p-7 rounded-[2.5rem] shadow-2xl h-full flex flex-col relative overflow-hidden">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6 relative z-10">
                        <h2 class="text-xl font-bold text-white uppercase italic">ì°¸ì„ì¸ì› <span id="player-count" class="text-blue-400 text-xs font-normal ml-2">0ëª…</span></h2>
                        <div class="flex gap-1.5 w-full md:w-auto">
                            <select id="match-type" class="flex-1 md:flex-none bg-slate-800 text-white text-[12px] px-5 py-3 rounded-xl font-bold border border-slate-700">
                                <option value="gender">ë‚¨ë³µ/ì—¬ë³µ</option><option value="mixed" selected>í˜¼ë³µ</option><option value="random">ëœë¤</option>
                            </select>
                            <button onclick="generateTimeline()" class="flex-1 md:flex-none bg-blue-600 text-white px-6 py-3 rounded-xl font-black text-[12px] active:scale-95 transition-all shadow-lg uppercase">ìƒì„±</button>
                        </div>
                    </div>
                    <div id="stadium-pool" class="flex-grow flex flex-wrap gap-2 p-6 rounded-2xl border border-slate-700 border-dashed bg-slate-800/30 min-h-[180px] content-start relative z-10 overflow-y-auto"></div>
                </div>
            </div>
        </div>

        <section id="capture-area" class="mb-16 bg-white p-8 rounded-[3.5rem] shadow-sm">
            <div class="mb-8 border-b pb-4 flex justify-between items-end">
                <div>
                    <h2 class="text-3xl font-black text-slate-900 tracking-tighter uppercase italic">ëŒ€ì§„í‘œ</h2>
                    <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">Tennis Arena Official Match Sheet</p>
                </div>
                <p id="capture-date" class="text-sm font-black text-blue-600"></p>
            </div>
            <div id="timeline-board" class="timeline-scroll">
                <div class="w-full text-center py-20 text-slate-300 font-bold uppercase text-xs">ì°¸ì„ìë¥¼ ì„ íƒí•˜ê³  ëŒ€ì§„ì„ ìƒì„±í•˜ì„¸ìš”.</div>
            </div>
        </section>

        <section class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start pb-20">
            <div class="lg:col-span-7 glass-card p-8 rounded-[3rem]">
                <h3 class="text-lg font-black text-slate-800 uppercase mb-6 tracking-tight">ğŸ“Š ì˜¤ëŠ˜ ë§¤ì¹­ ìƒì„¸ í†µê³„</h3>
                <div id="stat-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
            <div class="lg:col-span-5 stadium-panel p-8 rounded-[3rem] shadow-2xl text-white">
                <h3 class="text-lg font-black text-blue-400 uppercase mb-8 tracking-[0.2em]">ğŸ† Club Ranking</h3>
                <div id="ranking-list" class="space-y-3 font-mono text-xs"></div>
            </div>
        </section>
        
        <footer class="mt-10 mb-20 text-center">
            <button onclick="resetAllData()" class="text-[9px] font-black text-red-400 uppercase tracking-[0.3em] underline">Reset All Arena Data</button>
        </footer>
    </div>

    <script>
        const initialMembers = [
            { id: 1, name: 'ê¹€ì² ìˆ˜', gender: 'ë‚¨', ntpr: 3.5 }, { id: 2, name: 'ì´ì˜í¬', gender: 'ì—¬', ntpr: 3.0 },
            { id: 3, name: 'ë°•ì§€ì„±', gender: 'ë‚¨', ntpr: 4.5 }, { id: 4, name: 'ì†í¥ë¯¼', gender: 'ë‚¨', ntpr: 5.0 },
            { id: 5, name: 'ê¹€ì—°ì•„', gender: 'ì—¬', ntpr: 4.0 }, { id: 6, name: 'ì°¨ì€ìš°', gender: 'ë‚¨', ntpr: 3.5 },
            { id: 7, name: 'í•œì†Œí¬', gender: 'ì—¬', ntpr: 2.5 }, { id: 8, name: 'ê°•ë™ì›', gender: 'ë‚¨', ntpr: 4.0 },
            { id: 9, name: 'ì•„ì´ìœ ', gender: 'ì—¬', ntpr: 3.0 }, { id: 10, name: 'ê³µìœ ', gender: 'ë‚¨', ntpr: 4.5 },
            { id: 11, name: 'ì¹´ë¦¬ë‚˜', gender: 'ì—¬', ntpr: 3.5 }, { id: 12, name: 'ìœˆí„°', gender: 'ì—¬', ntpr: 3.0 }
        ];

        let members = JSON.parse(localStorage.getItem('tennis_v85_data')) || initialMembers;
        let stadium = [];
        let playerStats = {};
        let editingId = null;

        document.addEventListener('DOMContentLoaded', () => {
            const now = new Date();
            document.getElementById('capture-date').innerText = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            renderLibrary(); renderRanking(); initCourtInputs();
            document.getElementById('court-count').addEventListener('change', initCourtInputs);
        });

        function saveLocal() { localStorage.setItem('tennis_v85_data', JSON.stringify(members)); }

        // [V8.5 í•µì‹¬] ì „ì²´ ëŒ€ì§„í‘œ ì´ë¯¸ì§€ ì €ì¥ ë¡œì§
        async function saveAsImage() {
            const target = document.getElementById('capture-area');
            const board = document.getElementById('timeline-board');
            
            if (stadium.length === 0) return alert('ëŒ€ì§„í‘œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
            
            alert('ì „ì²´ ì½”íŠ¸ ëŒ€ì§„í‘œë¥¼ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ë¡œ ìƒì„±í•©ë‹ˆë‹¤.\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');

            // 1. ì„ì‹œë¡œ ê°€ë¡œ ìŠ¤í¬ë¡¤ì„ í•´ì œí•˜ê³  ì „ì²´ë¥¼ í¼ì¹¨
            const originalBoardClass = board.className;
            board.className = "capture-mode"; 

            try {
                const canvas = await html2canvas(target, { 
                    backgroundColor: '#ffffff', 
                    scale: 2, 
                    useCORS: true,
                    windowWidth: 1200, // ë„‰ë„‰í•œ ë„ˆë¹„ í™•ë³´
                });

                const data = canvas.toDataURL("image/png");
                const win = window.open();
                
                if(!win) {
                    const link = document.createElement('a');
                    link.download = `TennisArena_FullTimeline_${Date.now()}.png`;
                    link.href = data; link.click();
                    alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì–´ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
                } else {
                    win.document.write(`<body style="margin:0; background:#333; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; font-family:sans-serif;">
                        <p style="color:white; font-size:14px; margin-bottom:15px;">ì „ì²´ ì½”íŠ¸ê°€ í¬í•¨ëœ ì´ë¯¸ì§€ì…ë‹ˆë‹¤. ê¸¸ê²Œ ëˆŒëŸ¬ ì‚¬ì§„ì²©ì— ì €ì¥í•˜ì„¸ìš”.</p>
                        <img src="${data}" style="max-width:95%; max-height:80vh; border:2px solid #555; box-shadow:0 0 30px rgba(0,0,0,0.5);">
                        <button onclick="window.close()" style="margin-top:20px; padding:12px 24px; background:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer;">ë‹«ê¸°</button>
                    </body>`);
                }
            } catch (e) {
                alert('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error(e);
            } finally {
                // 2. ìº¡ì²˜ê°€ ëë‚˜ë©´ ì›ë˜ ë ˆì´ì•„ì›ƒ(ê°€ë¡œ ìŠ¤í¬ë¡¤)ìœ¼ë¡œ ë³µêµ¬
                board.className = originalBoardClass;
            }
        }

        // --- ê¸°íƒ€ ë°ì´í„° ì—°ë™ ë¡œì§ ---
        function exportData() {
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(JSON.stringify(members, null, 2));
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', `TennisArena_Backup_${new Date().toLocaleDateString()}.json`);
            linkElement.click();
            alert('ë°±ì—… íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    members = JSON.parse(e.target.result);
                    saveLocal(); location.reload();
                } catch (err) { alert('íŒŒì¼ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
            };
            reader.readAsText(file);
        }

        function togglePlayer(id) {
            const idx = stadium.findIndex(m => m.id === id);
            if (idx > -1) { stadium.splice(idx, 1); delete playerStats[id]; } 
            else {
                const p = members.find(m => m.id === id);
                if (p) { stadium.push({...p}); playerStats[id] = { games: 0, wins: 0, losses: 0, ptsWon: 0, ptsLost: 0 }; }
            }
            renderStadium(); renderLibrary(); renderStats();
        }

        function addOrUpdatePlayer() {
            const name = document.getElementById('p-name').value.trim();
            const gender = document.getElementById('p-gender').value;
            const ntpr = parseFloat(document.getElementById('p-ntpr').value);
            if (!name) return alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');

            if (editingId) {
                const p = members.find(m => m.id === editingId);
                if(p) { p.name = name; p.gender = gender; p.ntpr = ntpr; }
                editingId = null; document.getElementById('submit-btn').innerText = "Add / Update";
            } else { members.push({ id: Date.now(), name, gender, ntpr }); }
            saveLocal(); renderLibrary(); renderRanking(); resetForm();
        }

        function editPlayer(id, e) {
            if(e) e.stopPropagation();
            const p = members.find(m => m.id === id);
            editingId = id; document.getElementById('p-name').value = p.name;
            document.getElementById('p-gender').value = p.gender;
            document.getElementById('p-ntpr').value = p.ntpr;
            document.getElementById('submit-btn').innerText = "Update Info";
            document.getElementById('cancel-btn').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetForm() { editingId = null; document.getElementById('p-name').value = ''; document.getElementById('cancel-btn').classList.add('hidden'); }

        function renderLibrary() {
            document.getElementById('member-library').innerHTML = members.map(m => {
                const isSelected = stadium.some(s => s.id === m.id);
                return `
                    <div onclick="togglePlayer(${m.id})" class="relative p-3 rounded-2xl border transition-all ${m.gender === 'ë‚¨' ? 'male-gradient' : 'female-gradient'} ${isSelected ? 'border-blue-600 ring-2 ring-blue-500/10' : 'border-slate-100'} shadow-sm">
                        <div class="font-bold text-[11px] truncate">${m.name} ${isSelected ? 'âœ…' : ''}</div>
                        <div class="text-[8px] opacity-40 font-black italic">NTPR ${m.ntpr.toFixed(2)}</div>
                        <button onclick="editPlayer(${m.id}, event)" class="absolute top-1 right-1 bg-white/60 rounded-full w-5 h-5 text-[8px] flex items-center justify-center border">âœ</button>
                    </div>`;
            }).join('');
        }

        function renderStadium() {
            const pool = document.getElementById('stadium-pool');
            document.getElementById('player-count').innerText = `${stadium.length}ëª…`;
            if (stadium.length === 0) { pool.innerHTML = `<p class="text-slate-500 text-[11px] italic w-full text-center py-10">í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>`; return; }
            pool.innerHTML = stadium.map(m => `
                <div class="px-3 py-1.5 rounded-xl text-[10px] font-black shadow-lg flex items-center gap-2 ${m.gender === 'ë‚¨' ? 'bg-blue-600 text-white' : 'bg-rose-600 text-white'}">
                    <span onclick="togglePlayer(${m.id})" class="cursor-pointer opacity-70">âœ•</span><span>${m.name}</span>
                </div>`).join('');
        }

        function initCourtInputs() {
            const count = parseInt(document.getElementById('court-count').value);
            document.getElementById('court-config-list').innerHTML = Array.from({length: count}, (_, i) => `
                <div class="flex items-center justify-between p-2.5 bg-slate-50 rounded-xl border border-slate-100 text-[10px] font-bold">
                    <span class="text-slate-400 uppercase tracking-tighter">${i+1}ë²ˆ ì½”íŠ¸</span>
                    <select id="court-${i+1}-start" class="bg-transparent text-blue-600 outline-none">${Array.from({length: 24}, (_, h) => `<option value="${h}" ${h===14 ? 'selected' : ''}>${h}:00</option>`).join('')}</select>
                    <select id="court-${i+1}-duration" class="bg-transparent text-slate-500 outline-none">${Array.from({length: 6}, (_, d) => `<option value="${d+1}">${d+1}ì‹œê°„</option>`).join('')}</select>
                </div>`).join('');
        }

        function generateTimeline() {
            if (stadium.length < 4) return alert('4ëª… ì´ìƒ ì„ íƒí•˜ì„¸ìš”.');
            const board = document.getElementById('timeline-board'); board.innerHTML = '';
            stadium.forEach(p => playerStats[p.id] = { games: 0, wins: 0, losses: 0, ptsWon: 0, ptsLost: 0 });

            for (let c = 1; c <= parseInt(document.getElementById('court-count').value); c++) {
                const start = parseInt(document.getElementById(`court-${c}-start`).value);
                const slots = parseInt(document.getElementById(`court-${c}-duration`).value) * 2;
                const col = document.createElement('div');
                col.className = 'court-column space-y-4';
                col.innerHTML = `<div class="p-4 bg-slate-900 text-white rounded-[1.8rem] shadow-xl font-black text-center text-[9px] uppercase tracking-widest">${c}ë²ˆ ì½”íŠ¸</div>`;
                
                for (let s = 0; s < slots; s++) {
                    const h = start + Math.floor(s/2);
                    const timeStr = `${h < 10 ? '0'+h : h}:${(s%2===0 ? '00' : '30')}`;
                    const players = getSmartMatch(document.getElementById('match-type').value, c);
                    col.innerHTML += renderMatchCard(s + 1, timeStr, players);
                    players.forEach(p => { if(p) playerStats[p.id].games++; });
                }
                board.appendChild(col);
                col.querySelectorAll('.drag-zone').forEach(el => new Sortable(el, { group: 'tennis', animation: 200 }));
            }
            renderStats();
        }

        function getSmartMatch(type, courtIdx) {
            let pool = [...stadium].sort((a, b) => playerStats[a.id].games - playerStats[b.id].games || Math.random() - 0.5);
            if (type === 'gender') {
                let m = pool.filter(p => p.gender === 'ë‚¨'), f = pool.filter(p => p.gender === 'ì—¬');
                return courtIdx % 2 !== 0 ? (m.length >= 4 ? m.slice(0, 4) : pool.slice(0, 4)) : (f.length >= 4 ? f.slice(0, 4) : pool.slice(0, 4));
            } else if (type === 'mixed') {
                let m = pool.filter(p => p.gender === 'ë‚¨'), f = pool.filter(p => p.gender === 'ì—¬');
                return (m.length >= 2 && f.length >= 2) ? [m[0], f[0], m[1], f[1]] : pool.slice(0, 4);
            }
            return pool.slice(0, 4);
        }

        function renderMatchCard(round, time, p) {
            return `
                <div class="match-card glass-card p-5 rounded-[2.2rem] border-t-8 border-slate-800 shadow-sm">
                    <div class="flex justify-between items-center mb-4 text-[9px] font-black"><span class="text-slate-400 font-mono italic">ROUND ${round}</span><span class="text-blue-600 font-mono font-black">${time}</span></div>
                    <div class="space-y-3"><div class="drag-zone space-y-1">${renderPlayerMini(p[0])} ${renderPlayerMini(p[1])}</div><div class="text-center text-[7px] font-black text-slate-200 tracking-[0.5em]">VS</div><div class="drag-zone space-y-1">${renderPlayerMini(p[2])} ${renderPlayerMini(p[3])}</div></div>
                    <div class="mt-5 flex items-center justify-between gap-1.5 bg-slate-50 p-3 rounded-2xl">
                        <input type="number" class="score-input score-a" placeholder="0"><input type="number" class="score-input score-b" placeholder="0">
                        <button onclick="confirmResult(this)" class="bg-slate-900 text-white px-4 py-2.5 rounded-xl text-[9px] font-black active:scale-95 shadow-md uppercase">Save</button>
                    </div>
                </div>`;
        }

        function renderPlayerMini(p) {
            if (!p) return `<div class="p-3 bg-white/50 border border-dashed rounded-xl text-[8px] text-center text-slate-300">Wait</div>`;
            return `<div class="p-3 rounded-xl shadow-sm text-[10px] font-black flex justify-between items-center cursor-move ${p.gender === 'ë‚¨' ? 'male-gradient' : 'female-gradient'}" data-id="${p.id}"><span>${p.name}</span><span class="text-[7px] opacity-40 font-mono">${p.ntpr.toFixed(2)}</span></div>`;
        }

        function confirmResult(btn) {
            const card = btn.closest('.match-card'), sa = parseInt(card.querySelector('.score-a').value), sb = parseInt(card.querySelector('.score-b').value);
            if (isNaN(sa) || isNaN(sb)) return alert('ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            const p = card.querySelectorAll('[data-id]'), tA = [p[0].dataset.id, p[1].dataset.id], tB = [p[2].dataset.id, p[3].dataset.id];
            [...tA].forEach(id => { playerStats[id].ptsWon += sa; playerStats[id].ptsLost += sb; if(sa>sb) playerStats[id].wins++; else if(sb>sa) playerStats[id].losses++; });
            [...tB].forEach(id => { playerStats[id].ptsWon += sb; playerStats[id].ptsLost += sa; if(sb>sa) playerStats[id].wins++; else if(sa>sb) playerStats[id].losses++; });
            sa > sb ? applyNtpr(tA, 0.1) : (sb > sa ? applyNtpr(tB, 0.1) : null); 
            card.classList.add('match-finished'); btn.innerHTML = 'DONE âœ“'; saveLocal(); renderStats(); renderRanking(); renderLibrary();
        }

        function applyNtpr(ids, change) { ids.forEach(id => { const m = members.find(m => m.id == id); if (m) m.ntpr = Math.min(7.0, m.ntpr + change); }); }

        function renderStats() {
            document.getElementById('stat-grid').innerHTML = stadium.map(m => {
                const s = playerStats[m.id], d = s.ptsWon - s.ptsLost;
                return `<div class="bg-white p-4 rounded-3xl border-l-8 ${m.gender === 'ë‚¨' ? 'border-l-blue-500' : 'border-l-rose-500'} shadow-sm flex flex-col gap-2">
                    <div class="flex justify-between items-center font-black"><span class="text-slate-800 text-xs">${m.name}</span><span class="text-[8px] text-slate-400 italic">${s.games}G Played</span></div>
                    <div class="grid grid-cols-2 gap-2 text-[10px] font-bold"><div class="bg-slate-50 p-2 rounded-xl text-center font-black italic">${s.wins}W ${s.losses}L</div><div class="bg-slate-50 p-2 rounded-xl text-center font-black italic">${s.ptsWon}:${s.ptsLost} (${d>=0?'+':''}${d})</div></div>
                </div>`;
            }).join('');
        }

        function renderRanking() {
            document.getElementById('ranking-list').innerHTML = [...members].sort((a,b)=>b.ntpr-a.ntpr).map((m,i)=>`
                <div class="flex items-center justify-between p-3 rounded-2xl ${i===0?'rank-1':i===1?'rank-2':i===2?'rank-3':'bg-white/5 border border-white/10 shadow-sm'}">
                    <div class="flex items-center gap-4"><span class="text-[10px] font-black w-4 text-center tracking-tighter">${i===0?'ğŸ‘‘':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':i+1}</span><span class="font-black text-[12px] uppercase tracking-tighter italic">${m.name}</span></div><span class="text-[12px] font-black tracking-tighter">${m.ntpr.toFixed(2)}</span>
                </div>`).join('');
        }

        function resetAllData() { if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')) { localStorage.clear(); location.reload(); } }
        
        function copyToClipboard() {
            if (stadium.length === 0) return alert('ëŒ€ì§„í‘œê°€ ì—†ìŠµë‹ˆë‹¤.');
            let text = `ğŸ¾ [UBUNTU ë§¤ì¹­ì‹œìŠ¤í…œ ëŒ€ì§„í‘œ]\n`;
            document.querySelectorAll('.court-column').forEach(col => {
                text += `\nğŸ“ ${col.firstChild.innerText}\n`;
                col.querySelectorAll('.match-card').forEach(card => {
                    const time = card.querySelector('.text-blue-600').innerText;
                    const p = Array.from(card.querySelectorAll('[data-id]')).map(p => p.innerText.split('\n')[0].trim());
                    if(p.length >= 4) text += `${time} | ${p[0]},${p[1]} VS ${p[2]},${p[3]}\n`;
                });
            });
            const textarea = document.createElement("textarea");
            textarea.value = text; document.body.appendChild(textarea);
            textarea.select(); try { document.execCommand('copy'); alert('ì¹´í†¡ìš© ë³µì‚¬ ì™„ë£Œ!'); } catch(e) { alert('ë³µì‚¬ ì‹¤íŒ¨'); }
            document.body.removeChild(textarea);
        }
    </script>
</body>
</html>
